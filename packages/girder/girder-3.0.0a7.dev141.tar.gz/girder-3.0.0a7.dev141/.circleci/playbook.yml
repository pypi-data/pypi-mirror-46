---
- name: Provision
  hosts: all

  vars:
    girder_virtualenv: "{{ ansible_user_dir }}/.virtualenvs/girder"

  pre_tasks:
    - name: Install python prereqs
      apt:
        name:
          - python-setuptools
          - python-virtualenv
          - python-dev
      become: true
      become_user: root

    - name: Create virtualenv
      command: |
        virtualenv "{{ girder_virtualenv }}"
      args:
        creates: "{{ girder_virtualenv }}"

  roles:
    - role: girder.mongodb
      vars:
        mongodb_version: 3.6

    - role: ansible-role-girder
      vars:
        girder_daemonize: false

  post_tasks:
    # Needed for replicaset/sharded tests
    - name: Install mongos
      apt:
        name: mongodb-org-mongos
      become: true
      become_user: root
