.. include:: /../docs/shared/include/defs.rst
.. _xl.changes.2018:

=======================
Changes 2018 in Lino XL
=======================


.. contents::
  :local:

December
========

Fixed :ticket:`2715` in :mod:`lino_xl.lib.contacts`.

(20181226) Removed the pisa build method for printable documents. :ref:`cosi`
now uses :mod:`lino_xl.lib.weasyprint` as the default build method.

Released :ref:`cosi` 18.12.1

(20181225) Installing :ref:`cosi` with the pip command now works with Python3
as described in :ref:`user.install`.


.. currentmodule:: lino_xl.lib.beid

(20181224) fixed :ticket:`2773` in :mod:`lino_xl.lib.beid` :  when calling
eidreader while no id card was inserted into the reader sometimes caused a
server error message instead of just telling the user that there was no card.

.. currentmodule:: lino_xl.lib.topics

(20181222) :mod:`lino_xl.lib.topics` : :class:`Interest` now has
:attr:`allow_cascaded_delete <lino.core.model.Model.allow_cascaded_delete>` set
to ``["partner"]``. IOW the interests of a partner should not prevent a user
from deleting the partner.  If the user decides to delete a partner and some
existing :class:`Interest` refers to the partner, it should be deleted
automatically.

.. currentmodule:: lino_xl.lib.beid

(20181221) :mod:`lino_xl.lib.beid` : New error message :message:`Invalid
urlhandler_prefix {} (must end with '://')` when :attr:`urlhandler_prefix
<Plugin.urlhandler_prefix>` does not end with ``"://"``.


.. _xl.18.12.4:

2018-12-18
==========

Released version 18.12.5

The :class:`lino_xl.lib.xl.Priorities` choicelist was moved from
:mod:`lino_xl.lib.tickets` to :mod:`lino_xl.lib.xl` so that it can be used by
any plugin of the XL. The :class:`cal.Priority` model and its FK in
:class:`cal.Event <lino_xl.lib.cal.Event>` have been removed. Added a
choicelist field :attr:`lino_xl.lib.cal.Component.priority` pointing to
:class:`Priorities <lino_xl.lib.xl.Priorities>`. Priorities can't be
configured using the web interface any more, this is now done using a local
choicelists module.

Applications using :mod:`lino_xl.lib.cal` must do a database migration::

    def create_cal_event(id, modified, created, start_date, start_time, end_date, e$
        ...
        #kw.update(priority_id=priority_id)
        ...

    def main(args):
        ...
        #execfile("cal_priority.py", *args)
        ...



The :meth:`get_table_summary` of :class:`lino_xl.lib.blog.LatestEntries` now
also returns an etree element (instead of a string with HTML).


.. _lino.18.12.2:

2018-12-13
==========

Released version 18.12.3

.. _lino.18.12.1:

2018-12-12
==========

Released version 18.12.1

  :class:`lino_noi.lib.tickets.Ticket` now shows
  the total work time (one sum per reporting type) of a ticket.

  The summary panel of SessionsByTicket no longer has a ▶ button for starting a
  session from ticket. Because the same button exists already in the workflow
  buttons where it is more intelligent because the ▶ cheanges to ■ when the
  user has an open session on this ticket.


.. _lino.18.12.0:

2018-12-11
==========

Released version 18.12.0

We are still working on :ticket:`2741` (Have book test pass with PyPI version
of lino and lino_xl).

.. _lino.18.11.0:

2018-12-10
==========

Released version 18.11.0

Fixed :ticket:`2731` in :mod:`lino_xl.lib.cal`:
:class:`lino_xl.lib.cal.MyTasks` no longer hides open tasks that were started
in the past. PublishEvent is now allowed for a meeting that lies in the past.

:mod:`lino_xl.lib.courses`: the Explorer menu now shows courses.CourseStates

November 2018
=============

- :ticket:`2682` Optionally allow dashboard items with no data to display
- :ticket:`2670` Leaving a combobox before its store is loaded
- :ticket:`2668` Grid keyboard nav optimizations
- :ticket:`2660` Configure the choices of a TimeField
- :ticket:`2648` Show toolbar list actions in display_type "html"
- :ticket:`2646` Cell cursor jumps to home after inserting a line
- :ticket:`2644` Show current state's button_text in workflow_buttons
- :ticket:`2632` Hovering over the column header of a grid doesn't display the help_text

- :ticket:`2497` Comboboxes sometimes show the value instead of the text
  (:ticket:`2628` ForeignKey fields are not rendered correctly when detail loads
  first time)

- :ticket:`2623` Inconsistent meaning of Ctrl-S and Enter
- :ticket:`2596` Search field is disabled by loadmask
- :ticket:`2577` Row-level edit locking
- :ticket:`2544` SiteSearch fails when it finds a name containing "&"



.. _v18.9:
.. _lino.18.10:

2018-10-30
==========

New features visible to end-users:

- A new implementation of the Accounting Report.
  :class:`sheets.Report <lino_xl.lib.sheets.Report>` replaces the
  :class:`ledger.AccountingReport
  <lino_xl.lib.ledger.AccountingReport>`.  It now includes subtotals,
  analytic accounts balances, balance sheet and income statement.
  It is no longer a virtual table but
  a :class:`lino.modlib.users.UserPlan`.

- Optimizations in :mod:`lino_xl.lib.cal` :class:`OverdueAppointments
  <lino_xl.lib.cal.OverdueAppointments>` : the default view no longer
  includes today, it stops yesterday.  Because today's appointments
  are shown by :class:`lino_xl.lib.cal.MyAppointmentsToday`.



Database changes

- Subclasses of :class:`lino.mixins.refs.Referrable` now always have
  `max_length=200`.

Internal changes:

- release tags in 18.8 were missing in the git repo because atelier
  did not yet push them.

- New model mixin :class:`lino.mixins.refs.StructuredReferrable`.

- New model mixin :class:`lino.modlib.users.UserPlan`.

- plain html tables now use ``class="text-cell"`` instead of a
  hard-coded set of attributes  ``align="left"``.

- The :meth:`lino.core.renderer.HtmlRenderer.table2story` method now
  yields a sequence of elements instead of returning a single one.

- We have a new method :meth:`lino.core.requests.BaseRequest.show_story`
  which is used in the template for the report
  (:xfile:`ledger/Report/default.weazy.html`).

- in :mod:`lino.api.doctest`, show_sql_queries and show_sql_summary no
  longer call reset_sql_queries.

- we continued to improve the documentation

- :func:`lino.api.doctest.show_sql_summary` now supports INSERT INTO
  and DELETE FROM statements. It now uses `sqlparse
  <https://sqlparse.readthedocs.io/en/latest/>`__.


.. _v18.8:

2018-08-31
============

Version 18.8 was the first release for which pip install worked.  At least
under Python 2.

Released packages: :mod:`lino`, :mod:`lino_xl`, :mod:`lino_cosi`,
:mod:`lino_noi` , :mod:`lino_tera`, :mod:`lino_amici`,
:mod:`lino_avanti`, :mod:`lino_welfare`, :mod:`lino_vilma`,
:mod:`lino_care`.

There were many changes... we just didn't collect descriptions of them yet.

- 20180521 Fixed :ticket:`2393` (Wrong error message when no eid card
  found)

- 20180522 Fixed :ticket:`2395` (Unknown callback
  -9223363281463807000).

