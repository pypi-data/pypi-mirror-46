language: python
sudo: false
dist: xenial
services:
  - docker

cache:
  directories:
  - "${HOME}/.cache"
matrix:
  include:
  - python: 3.4
    env: TOXENV=py34
  - python: 3.5
    env: TOXENV=py35
  - python: 3.6
    env: TOXENV=py36
  - python: 3.7
    env: TOXENV=py37
install:
- pip install tox
script:
- tox
- docker run -v $(pwd)/policy:/opt/opa/policy openpolicyagent/opa test -v /opt/opa/policy
notifications:
  email: false
deploy:
  provider: pypi
  user: "cleardata"
  password:
    secure: "pPGQuORPiWl5Cjkh1tltS61Cw2RBE9tEacllxGLOEWXqqMGXkn0Q2FrajoDFZa6avicoH2AdDFiW8bRvMp9VKtrbLlvqWSjBG/ANCHu9YV3BsTPSTKxdqdK9hFm20aW+AeN3rKMy8XQo0UddavvsoHSoQkhZgMIttY8Ock1Kb/4JwilT0pokQIN0WSOlzDK4GNNQ33SIfUYndthpwTDI5/rjAgnyF9kaxHkXsR6JiEEi+uM2pD8zbzR44KFsynXjNrHjE9KFvnitgQ979fs4c7cxq/VzcqLN80R7beQpm9uhizgsOAFC6IIWOTm7A6h9XYS1+36AOYSCrrav0D7ER3wQZdKNGVRqMkNiKXIaU5hWtcGP3TMpSeEArYwMgAyz51J7ELkuNoy7H2LzKTISSBHu2Nup/9VpI7jiyTr5+rinYnJOPypwghDBG5FIR5/0yQ1+PS2c/Yj/b9t/Lyv/QHwZCkdpRCunTJ0HRAlhwdT513AlVDiKNQLEb+JUk3Iab/rC2wdXpn5XdtTDY8w97vsvvLIp/ZfzVqCu9KfrUtFwdompW0mm4PVpVKZ/LV2HPLSBiIU06Z88uJFVM/uxjfopG3WRLwSHsHkYXLBYIGoxkgJ7XwhIn3GIN3sM9tLqmk9QENkfsd8yLk85OArBmc5anurfOusFmJRYl1wJPzQ="
  on:
    tags: true
  skip_existing: true
