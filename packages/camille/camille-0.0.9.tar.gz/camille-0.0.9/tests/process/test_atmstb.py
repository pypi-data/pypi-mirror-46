#!/usr/bin/env python
import pandas as pd
import numpy as np

from camille import process

amb_data = [0.70131019, 0.89018502, 0.65405949, 0.3857633,  0.37878664,
            0.78061511, 0.7237867,  0.81625648, 0.95503992, 0.03529543,
            0.80623759, 0.66334832, 0.94678946, 0.49773332, 0.49956338,
            0.65713409, 0.65315634, 0.31672856, 0.30282667, 0.5387677,
            0.73821584, 0.76364956, 0.05098648, 0.4385946,  0.30631272,
            0.55926291, 0.49193616, 0.59403465, 0.15299467, 0.89199398,
            0.38621302, 0.2242491,  0.03541603, 0.87387054, 0.61404747,
            0.0177202,  0.0802896,  0.12001825, 0.90696498, 0.68482745,
            0.63348953, 0.44069217, 0.88573973, 0.8045516,  0.92765043,
            0.13447804, 0.66251035, 0.80571398, 0.91454438, 0.86777224,
            0.70947088, 0.89087851, 0.83786881, 0.50056601, 0.5247692,
            0.73615452, 0.93605393, 0.23438514, 0.63688784, 0.30999835,
            0.6053433,  0.55547775, 0.41213838, 0.61768015, 0.56785998,
            0.10682701, 0.46891464, 0.62727602, 0.22031211, 0.51181368,
            0.26501052, 0.95314735, 0.49137422, 0.47722779, 0.47323347,
            0.76993723, 0.56522302, 0.98902885, 0.71417176, 0.91654984,
            0.81960825, 0.43192446, 0.14429576, 0.83388236, 0.48524638,
            0.54779511, 0.33188289, 0.3384233,  0.62679775, 0.54461735,
            0.1766276,  0.60889945, 0.47405039, 0.47418249, 0.30020767,
            0.62931009, 0.8421696,  0.28500048, 0.43077346, 0.16602324,
            0.48555785, 0.77539169, 0.97842982, 0.5614722, 0.30014486,
            0.92078187, 0.34908545, 0.20603708, 0.38194938, 0.52697926,
            0.36892318, 0.24897231, 0.80811578, 0.87420831, 0.07498351,
            0.80027083, 0.61608895, 0.35694731, 0.79592275, 0.78814683]


sea_data = [6.6139271586872025, 3.43404056610179853, 1.6886409108277656,
            0.5469472231030251, -2.5091739563307742, np.nan]

ref_index = pd.date_range('1/1/2018', periods=6, freq='20T')
ref_delta = pd.Series(
    [
        6.0037579731872025013, 2.987460655601798, 1.018932128827765515,
        -0.018480130396974825, -2.9837598603307742, np.nan,
    ],
    index=ref_index, name='delta_temp')
ref_atmstb = pd.Series(
    [
        'Very Unstable', 'Unstable', 'Slightly Unstable', 'Neutral', 'Stable',
        'Missing Data',
    ],
    index=ref_index, name='atm_stb')


def test_process():
    index = pd.date_range('1/1/2018', periods=120, freq='T')
    amb = pd.Series(data=amb_data, index=index)
    index = pd.date_range('1/1/2018', periods=6, freq='20T')
    sea = pd.Series(data=sea_data, index=index)

    res_delta = process.delta_temp(amb, sea)
    res_atmstb = process.atm_stb(res_delta)

    pd.testing.assert_series_equal(res_delta, ref_delta)
    pd.testing.assert_series_equal(res_atmstb, ref_atmstb)
