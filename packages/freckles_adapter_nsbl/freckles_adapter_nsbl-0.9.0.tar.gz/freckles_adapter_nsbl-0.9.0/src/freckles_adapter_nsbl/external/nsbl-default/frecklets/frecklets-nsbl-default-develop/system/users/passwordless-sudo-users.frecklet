doc:
  short_help: Grant passwordless sudo permission to a user.
  help: |
    Ensure that one or more users can use passwordless sudo.

    This also makes sure that the sudo package is installed (if not already available), and creates the user(s) (if not already present).

  further_reading:
    "'freckfrackery.basic-security' Ansible role": https://gitlab.com/freckfrackery/freckfrackery.basic-security
  examples:
    - title: Enable passwordless sudo for users 'freckles' and 'boingboing'.
      vars:
        users:
          - freckles
          - boingboing

args:
  users:
    type: list
    required: true
    schema:
      type: string
    cli:
      nargs: -1
      param_type: "argument"
      metavar: USER

meta:
  tags:
    - user
    - user-management
    - system
    - sudo
    - passwordless-sudo

frecklets:

  - task:
      loop: "{{:: users ::}}"
      include-type: "include"
      become: true
    frecklet:
      name: freckfrackery.basic-security
      type: ansible-role
      msg: "grant passwordless sudo permssions to user(s): {{:: users | join(' ') ::}}"
      elevated: true
      idempotent: true
      internet: false
      references:
        "'freckfrackery.basic-security' Ansible role": "https://gitlab.com/freckfrackery/freckfrackery.basic-security"
      frecklet::desc: |
        Make sure the follwing users have sudo permissions and do not need to enter a passwrod when executing ``sudo``:

        {%:: for u in users ::%}
        - {{:: u ::}}
        {%:: endfor ::%}
    vars:
      basic_security_user_name: "{{ item }}"
      basic_security_enable_passwordless_sudo: true
