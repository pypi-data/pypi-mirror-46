doc:
  short_help: Setup Airflow service

args:
  airflow_executor:
#    type: string
    doc: |
      The executor class that airflow should use.

      Choices include:

      - SequentialExecutor
      - LocalExecutor
      - CeleryExecutor
      - DaskExecutor
    type: string
    allowed:
      - SequentialExecutor
      - LocalExecutor
      - CeleryExecutor
      - DaskExecutor
    default: LocalExecutor



frecklets:
  - postgresql-database-exists:
      db_name: "airflow"
      db_user: "airflow"
      db_user_password: "md5053710be12d3c1a99ff746d66b84628c"
      postgresql_listen_addresses:
        - localhost
        - 10.0.0.22
#      postgresql_listen_addresses:
#        - localhost
#        - 192.168.178.204
#        - 192.168.194.204
      postgresql_pg_hba:
        - method: md5
      setup_postgresql: true
  - frecklet:
      type: ansible-role
      name: idealista.airflow-role
    task:
      become: true
      include-type: import
    vars:
      airflow_required_python_packages:
        - name: pyasn1
          version: 0.4.4
#      airflow_webserver_base_url: http://10.0.0.22:8080
      airflow_executor: "{{:: airflow_executor ::}}"
      airflow_load_examples: false
#      airflow_database_conn: "postgresql+psycopg2://airflow:WK+*g2'ltj{jnfcns@192.168.178.204:5432/airflow"
      airflow_database_conn: "postgresql+psycopg2://airflow:WK+*g2'ltj{jnfcns@10.0.0.22:5432/airflow"
