
{# ----------------------------- MACROS ------------------------------------- #}
{# -------------------------------------------------------------------------- #}

{# meta_tag_custom: create a custom meta tag 
    @params
    namespace
    name
    value    
#}
{% macro meta_tag_custom(namespace, name, value) %}
    <meta {{ namespace }}="{{ name }}" content="{{ value or '' | safe }}">
{% endmacro %}

{# meta_tag: create a meta tag 
    @params
    name
    value    
#}
{% macro meta_tag(name, value) %}
    {{ meta_tag_custom('name', name, value) }}
{% endmacro %}


{# meta_page_meta_tags: Set all the meta tags in the page  
#}
{% macro meta_page_meta_tags() %}
    {% for k, v in page.meta.items() %}
        {{ meta_tag(k, v) }}
    {% endfor %}
    {% set url =  site.base_url + page.url %}
    {{ meta_tag_custom('property', 'og:title', page.title or '') }}
    {{ meta_tag_custom('property', 'og:description', page.description or '') }}
    {{ meta_tag_custom('property', 'og:url', url) }}
    {{ meta_tag_custom('property', 'og:site_name', site.name or '') }}
    {{ meta_tag_custom('property', 'og:type', page.meta.object_type or 'article') }}
    {{ meta_tag_custom('itemprop', 'description', page.description or '') }}
    {{ meta_tag_custom('itemprop', 'name', page.title or '') }}
    {{ meta_tag_custom('itemprop', 'url', url) }}
    {{ meta_tag_custom('name', 'twitter:title', page.title or '') }}
    {{ meta_tag_custom('name', 'twitter:description', page.description or '') }}
    {{ meta_tag_custom('name', 'twitter:url', url) }}

    {% if not page.image %}
        {{ meta_tag_custom('name', 'twitter:card', "summary") }}
    {% endif %}

    {% if page.image %}
        {{ meta_tag_custom('property', 'og:image', page.image) }}
        {{ meta_tag_custom('itemprop', 'image', page.image) }}
        {{ meta_tag_custom('name', 'twitter:image', page.image) }}
        {{ meta_tag_custom('name', 'twitter:card', "summary_large_image") }}
    {% endif %}
{% endmacro %}



{# meta_page_title: Set the page title. Leave title empty to fallback to default
    @params
    title
    suffix
    separator    
#}
{% macro meta_page_title(title=None, suffix=None, separator='|') %}
    <title>{{ title or page.title or '' }} {{ separator }} {{ suffix or site.name }}</title>
    {{ meta_tag('title', title or page.title or '') }}
    <link rel="canonical" href="{{ site.base_url }}"/>
{% endmacro %}



{# meta_page_description: Set the page description. Leave description empty to fallback to default
    @params
    description    
#}
{% macro meta_page_description(description=None) %}
    {{ meta_tag('description', description or page.description or site.description or '') }}
{% endmacro %}


{# -------------------------------------------------------------------------- #}

{# static_url: get the url of an asset, ie: image, text, css, js, etc 
    @params 
    path
#}
{% macro static_url(path) %}
{{- path | kolibri_get_static_url -}}
{% endmacro %}


{# stylesheet_tag: to include css file
    @params
    path: the css file
    absolute: (Bool|False) By default point to /static. True to absolute
#}
{% macro stylesheet_tag(src, absolute=False) %}
    {% set url = static_url(src) if not absolute else src %}
    <link rel="stylesheet" href="{{ url }}" type="text/css" >
{% endmacro %}

{# script_tag: To include javascript file 
    @params
    path: the js source from the static folder
    props: string, ie: type="module"
    absolute: (Bool|False) By default point to /static. True to absolute    
#}
{% macro script_tag(src, props="", absolute=False) %}
    {% set url = static_url(src) if not absolute else src %}
    {% set _props = props if props else "type='text/javascript'" %}
    <script {{ _props }} src="{{ url }}"></script>
{% endmacro %}


{# -------------------------------------------------------------------------- #}

{# x_ga: include the google analytics code
    @params:
    code: GA code. if not provided, it will rely on the site config
#}
{% macro x_ga(code=None) %}
    {% if not code %}
        {% set code = site.google_analytics %}
    {% endif %}
    {% if code %}
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', '{{ code }}', 'auto');
          ga('send', 'pageview');
        </script>
    {% endif %}
{% endmacro %}

{# -------------------------------------------------------------------------- #}

{# page_markdown_toc: table of contents when using MD files #}
{% macro page_markdown_toc() %}
    {{ page.__toc__ }}
{% endmacro %}



{# -------------------------------------------------------------------------- #}
{# format_datetime: format datetime, using Arrow library
    @params
    dt: string 
    format: the format of the date, ie: MM/DD/YYYY h:mm a
#}
{% macro format_datetime(dt, format="MM/DD/YYYY h:mm a") %}
    {{- dt | kolibri_format_datetime(format) -}}
{% endmacro %}


{# -------------------------------------------------------------------------- #}
{# page_link:  create a href link to a page
    @params:
    page: the name, ie: index or index.html or index.md
    text: the text to create the link. If empty, it will use the link original text
    title: the link title.
    class: a class
    id: id
#}
{% macro page_link(page, text=None, title=None, class="", id="") %}
    {{- page | kolibri_create_page_link(text=text, title=title, _class=class, id=id) | safe -}}
{% endmacro %}



{# page_url: get a page url
    @params
    page: the name of the page, ie: index, index.html, index.md    
#}
{% macro page_url(page) %}
    {{- page | kolibri_get_page_url -}}
{% endmacro %}

{# page_info: get the page info
    @params
    page: the name of the page, ie: index, index.html, index.md  
    path: dot notation , ie: meta.x.y.z  
#}
{% macro page_info(page, path) %}
    {{ page | kolibri_get_page_info(path) }}
{% endmacro %}



{# -------------------------------------------------------------------------- #}




{# x_paginator: Create pagination
     @params
     prev: Text for previous button
     :next: Text for Next button
     :class: A class name for pagination if customed. If you are extending the class
             best to add the original class and your custom class
             ie: 'pagination my_custom_pagination' or 'pager my_custom_page'
     :pager: If true it will show a pager instead of numbered pagination
     :mobile: if True, if will show the pagination into a 'pager'

#}
{% macro x_paginator(prev="Prev", next="Next", class=None, pager=False, mobile=True) %}
    {% if mobile %}
        <div class="hidden-lg hidden-md hidden-sm">
            {{ _pagination(prev, next, class, pager=true, **kwargs) }}
        </div>
        <div class="hidden-xs">
            {{ _pagination(prev, next, class, pager=false, **kwargs) }}
        </div>
    {% else %}
        {{ _pagination(prev, next, class, pager, **kwargs) }}
    {% endif %}

{% endmacro %}

{%- macro _pagination_page_url(page_num) -%}
{{- page.paginator.slug | replace("{page_num}", page_num) | safe -}}
{%- endmacro -%}

{% macro _pagination(prev="", next="", class=None, pager=False) %}

    {{ kwargs }}

    {%  if not class %}
        {% set class = "pagination" %}
        {% if pager %}
            {% set class = "pager" %}
        {% endif %}
    {% endif %}

    {% set _prev_btn = "<span aria-hidden='true'>&larr;</span> %s" % prev %}
    {% set _next_btn = "%s <span aria-hidden='true'>&rarr;</span>" % next %}

    <nav>
      <ul class="{{ class }}">

          {%- if page.paginator.has_prev %}
            <li class="previous">
                <a href="{{ _pagination_page_url(page.paginator.prev_page_number) }}" >
                    {{ _prev_btn | safe }}
                </a>
            </li>
          {% else %}
            <li class="disabled previous">
                <a href="#">{{ _prev_btn | safe }}</a>
            </li>
          {%- endif %}

            {% if not pager %}
                  {%- for page_num in page.paginator.iter_pages() %}
                    {% if page_num %}
                      {% if page_num != page.paginator.page %}
                        <li><a href="{{ _pagination_page_url(page_num) }}"
                         rel="me">{{ page_num }}</a></li>
                      {% else %}
                        <li class="active"><span>{{ page_num }}</span></li>
                      {% endif %}
                    {% else %}
                      <li><span class="ellipsis">...</span></li>
                    {% endif %}
                  {%- endfor %}
            {% endif %}

          {%- if page.paginator.has_next %}
            <li class="next">
                <a href="{{ _pagination_page_url(page.paginator.next_page_number) }}">
                    {{ _next_btn | safe }}
                </a>
            </li>
          {% else %}
            <li class="disabled next">
                <a href="#">{{ _next_btn | safe }}</a>
            </li>
          {%- endif %}
      </ul>
    </nav>

{% endmacro %}

